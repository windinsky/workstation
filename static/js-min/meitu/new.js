/*! my-project-name 2016-03-11 */
windinsky.define("meitu/new",["images/wap_upload","zepto"],function(a){var b=a("zepto");b(".stars").on("touchstart",function(){var a=b(this);for(a.parent().find(".stars").removeClass("active");a.hasClass("stars");)a.addClass("active"),a=a.prev()});var c=a("images/wap_upload");c.setup_upload(".photo",function(a){var b=a.width,c=a.height,d=this.width()-2,e=this.height()-2,f=0;b/c>d/e?(c=c*d/b,b=d,f=(e-c)/2,d-=2*f):(b=b*e/c,c=e),this.css({padding:f+"px 0"}).find("img,span").remove(),this.append('<img style="width:'+b+"px;height:"+c+'px" src="'+a.src+'"/>')}),b('[name="photo"]').change(function(){var a=b("#before");b("#before_and_after")[0].checked?a.add(a.attr("target")).show():a.add(a.attr("target")).hide()}),b("#submit").on("touchend",function(){var a=b("#before img").attr("src"),c=b("#before_and_after")[0].checked,d=b("#after img").attr("src");if(c&&!a)return alert("请上传术前照片");if(c&&(a=""),!d)return alert("请上传术后照片");var e=[],e=b(".rate").map(function(){return b(this).find(".stars.active").length}).toArray().join(","),f=b("#comment").val();return f?void b.ajax({url:"/solution/create",data:{before:a,after:d,rates:e,comment:f},type:"post",success:function(a){location.href="/solution/list"}}):alert("请填写评论")})});