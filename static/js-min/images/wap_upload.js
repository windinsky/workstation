/*! my-project-name 2016-03-11 */
windinsky.define("images/wap_upload",["jquery"],function(a,b,c){var d=a("zepto"),e=function(){},f=null;b.setup_upload=function(a,b){f||(d(document.body).append('<div id="upload_img_loading" style="width:2rem;height:2rem;background:rgba(0,0,0,.8);display:none;border-radius:.08rem;position:absolute;left:50%;margin-left:-1rem;top:2rem;"><svg width="100%" height="100%"><path stroke="white" stroke-width="2" fill="none"/><text x="50%" y="50%" text-anchor="middle" style="font-size:12px;fill:white;">UPLOADING</text></svg></div>'),f=d("#upload_img_loading")),d(a).each(function(){var a=d('<div style="position:absolute;z-index:100;overflow:hidden;opacity:0"><input style="font-size:10000px" type="file"/></div>'),c=d(this);a.css({width:c.width()+"px",height:c.height()+"px",top:"0",left:"0"}),c.css("position","relative").append(a);var g=function(a){var b=this,c=a.target.files,h=c.length;return h>10?alert("you can only upload 10 photos once"):(d("#file").unbind("change"),void d.each(c,function(a,c){function i(a){if(console.log(a),a.lengthComputable){var b=a.total,c=a.loaded,d=c/b,e=f.width(),g=2*d*Math.PI,h=e/3;f.find("path").attr("d",["M",e/2,e/6,"A",e/3,e/3,0,g>Math.PI?1:0,1,h*Math.sin(Math.PI-g)+e/2,h*Math.cos(Math.PI-g)+e/2].join(" "))}}var j=new FormData;j.append("upload",c),f.show(),d.ajax({url:"/image/upload",data:j,type:"POST",dataType:"json",processData:!1,contentType:!1,success:function(a){return a.failed?void alert(a.msg):e.call(b,a)},xhr:function(){var a=d.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",i.bind(f),!1),a},complete:function(a){h--,h||(d("#file").val(""),d("#file").bind("change",g)),f.hide()}})}))};a.find("input").change(g.bind(c)),e=b})}});