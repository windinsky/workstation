var Condition = require('./condition');

const ABSOLUTE_TRUE = '1=1';
const ABSOLUTE_FALSE = '1=2';


exports.format_columns = function( columns ){

	if( typeof columns === 'string' ) return columns;

	if( !columns.join ) throw 'unrecognized columns';
	
	return columns.join( ',' );

}

exports.format_condition = function( conditions , start_with , end_with ){
	
	if( start_with && end_with ){
		throw 'you cannot specify start_with and end_with';
	}

	start_with = start_with || '';
	end_with = end_with || '';
	
	if( conditions instanceof String ){
		return {
			str : start_with + conditions + end_with,
			data : []
		}
	}

	if( conditions instanceof Condition ){
		return {
			str : start_with + conditions.str + end_with,
			data : conditions.data || []
		}
	}

	var str = [], data = [];

	if( conditions instanceof Array ){

		if( !conditions.length ){
			return absolute( start_with , end_with );
		}
		

		conditions.forEach( function(con){
			
			var _con = format_condition( con );
			str.push( _con.str );
			data = data.concat( _con.data );
			
		} );

		return {
			str : start_with + str.join(' and ') + end_with,
			data : data
		};

	}

	if( conditions instanceof Object ){
		
		if( JSON.stringify(conditions) === '{}' ) return absolute( start_with , end_with );

		for( var i in conditions ){

			if( conditions.hasOwnProperty(i) ){

				str.push( i + '=?');
				data.push(conditions[i]);

			}

		}

	}

}

function absolute( start_with , end_with ){

	return start_with + ( ( start_with + end_with === 'or' ) ? ABSOLUTE_FALSE : ABSOLUTE_TRUE ) + end_with;

}
